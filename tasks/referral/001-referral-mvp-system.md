# Task 001: Referralæ¨èç³»ç»ŸMVPå®ç°

## ğŸ¯ ç›®æ ‡

åˆ›å»ºä¸€ä¸ªæç®€ã€æ’æ‹”å¼çš„ç”¨æˆ·æ¨èç³»ç»ŸMVPï¼Œéµå¾ªå¥¥å¡å§†å‰ƒåˆ€åŸåˆ™ï¼ˆless is moreï¼‰ï¼Œå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼šAç”¨æˆ·è·å¾—æ¨èé“¾æ¥ï¼Œé€šè¿‡ç¤¾äº¤åª’ä½“åˆ†äº«ï¼ŒBç”¨æˆ·é€šè¿‡é“¾æ¥æ³¨å†Œ/è´­ä¹°ï¼ŒAç”¨æˆ·è·å¾—å¥–åŠ±ã€‚

### ä¸šåŠ¡ä»·å€¼
- ğŸ“ˆ **ç”¨æˆ·å¢é•¿**: é€šè¿‡ç¤¾äº¤è£‚å˜é™ä½è·å®¢æˆæœ¬
- ğŸ’° **è½¬åŒ–æå‡**: æ¨èæŠ˜æ‰£æé«˜è´­ä¹°è½¬åŒ–ç‡
- ğŸ”„ **å®¢æˆ·ç²˜æ€§**: å¥–åŠ±æœºåˆ¶å¢å¼ºç”¨æˆ·ç•™å­˜
- ğŸ¯ **å¯é…ç½®**: Adminé¢æ¿å¯è§†åŒ–é…ç½®å¥–åŠ±è§„åˆ™

## ğŸ“Š å½“å‰çŠ¶æ€

### ç°çŠ¶åˆ†æ
- âœ… æ•°æ®åº“å·²æœ‰referralsè¡¨åŸºç¡€ç»“æ„
- âœ… ç°æœ‰ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆSupabaseä¸»+Firebaseå¤‡ï¼‰
- âœ… ç°æœ‰æ”¯ä»˜ç³»ç»Ÿï¼ˆStripeï¼‰å’ŒWebhookå¤„ç†
- âœ… AdminåŒ…æ¶æ„å·²è§£è€¦ï¼Œæ”¯æŒç‹¬ç«‹åŠŸèƒ½æ¨¡å—
- âŒ ç¼ºå°‘æ¨èé“¾æ¥ç”Ÿæˆå’Œè¿½è¸ªæœºåˆ¶
- âŒ ç¼ºå°‘å¥–åŠ±è®¡ç®—å’Œå‘æ”¾é€»è¾‘
- âŒ ç¼ºå°‘Adminå¯è§†åŒ–é…ç½®ç•Œé¢

### æŠ€æœ¯èƒŒæ™¯
- **ä¸»æŠ€æœ¯æ ˆ**: Next.js 15, TypeScript, PostgreSQL, Drizzle ORM
- **åŒ…ç®¡ç†**: Monorepo workspaceæ¶æ„
- **ç°æœ‰åŒ…**: @rolitt/admin, @rolitt/shopify, @rolitt/email
- **è®¾è®¡ç³»ç»Ÿ**: shadcn/ui + Tailwind CSS

## ğŸ”§ å®æ–½æ­¥éª¤

- [ ] **æ­¥éª¤1**: åˆ›å»º@rolitt/referralåŒ…åŸºç¡€ç»“æ„ï¼Œå®ç°æ ¸å¿ƒReferralMVPç±»ï¼ˆ3ä¸ªå‡½æ•°ï¼‰
- [ ] **æ­¥éª¤2**: æ‰©å±•æ•°æ®åº“Schemaï¼Œå¢åŠ æ¨èè¿½è¸ªå¿…è¦å­—æ®µ
- [ ] **æ­¥éª¤3**: å®ç°æ¨èé“¾æ¥è¿½è¸ªé€»è¾‘ï¼Œé›†æˆåˆ°ç°æœ‰é¡µé¢è·¯ç”±
- [ ] **æ­¥éª¤4**: é›†æˆæ¨èå¥–åŠ±åˆ°ç°æœ‰checkoutæµç¨‹å’ŒStripe Webhook
- [ ] **æ­¥éª¤5**: åˆ›å»ºAdminé…ç½®é¢æ¿ï¼Œæ”¯æŒå¯è§†åŒ–é…ç½®å¥–åŠ±è§„åˆ™
- [ ] **æ­¥éª¤6**: åˆ›å»ºç”¨æˆ·æ¨èé¢æ¿ï¼Œæ˜¾ç¤ºæ¨èé“¾æ¥å’Œç»Ÿè®¡
- [ ] **æ­¥éª¤7**: æ·»åŠ ç¤¾äº¤åˆ†äº«æŒ‰é’®ç»„ä»¶
- [ ] **æ­¥éª¤8**: æµ‹è¯•å®Œæ•´æ¨èæµç¨‹å¹¶æ›´æ–°æ–‡æ¡£

## ğŸ“ æ¶‰åŠæ–‡ä»¶

### éœ€è¦åˆ›å»ºçš„æ–‡ä»¶
- `æ–°å»º: packages/referral/package.json` - ReferralåŒ…é…ç½®
- `æ–°å»º: packages/referral/src/index.ts` - æ ¸å¿ƒMVPå¯¼å‡º
- `æ–°å»º: packages/referral/src/mvp.ts` - ReferralMVPæ ¸å¿ƒé€»è¾‘ï¼ˆ3ä¸ªå‡½æ•°ï¼‰
- `æ–°å»º: packages/referral/src/admin/ReferralConfig.tsx` - Adminé…ç½®é¢æ¿
- `æ–°å»º: packages/referral/src/admin/ReferralStats.tsx` - Adminç»Ÿè®¡é¢æ¿
- `æ–°å»º: packages/referral/src/components/ReferralDashboard.tsx` - ç”¨æˆ·æ¨èé¢æ¿
- `æ–°å»º: packages/referral/src/components/ShareButtons.tsx` - ç¤¾äº¤åˆ†äº«ç»„ä»¶
- `æ–°å»º: packages/referral/README.md` - åŒ…æ–‡æ¡£

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
- `src/models/Schema.ts` - æ‰©å±•referralsè¡¨å­—æ®µ
- `src/app/actions/checkoutActions.ts` - é›†æˆæ¨èæŠ˜æ‰£é€»è¾‘
- `src/app/api/webhooks/stripe/route.ts` - å¤„ç†æ¨èå¥–åŠ±
- `src/app/[locale]/(marketing)/page.tsx` - æ·»åŠ æ¨èè¿½è¸ª
- `packages/admin/src/features/index.ts` - å¯¼å‡ºæ¨èç®¡ç†åŠŸèƒ½
- `src/app/[locale]/admin/referral/page.tsx` - Adminæ¨èç®¡ç†é¡µé¢
- `src/app/[locale]/(auth)/dashboard/page.tsx` - ç”¨æˆ·dashboardé›†æˆ

### é…ç½®æ–‡ä»¶
- `package.json` - æ·»åŠ referralåŒ…workspace
- `src/locales/en/referral.json` - è‹±æ–‡ç¿»è¯‘
- `src/locales/zh-HK/referral.json` - ä¸­æ–‡ç¿»è¯‘

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] Aç”¨æˆ·å¯ä»¥ç”Ÿæˆå”¯ä¸€æ¨èé“¾æ¥ï¼ˆæ ¼å¼ï¼šdomain.com?ref=encoded_user_idï¼‰
- [ ] Bç”¨æˆ·ç‚¹å‡»æ¨èé“¾æ¥æ—¶è‡ªåŠ¨è¿½è¸ªå¹¶è®¾ç½®30å¤©cookie
- [ ] Bç”¨æˆ·è´­ä¹°æ—¶è‡ªåŠ¨åº”ç”¨æ¨èæŠ˜æ‰£ï¼ˆ20%é»˜è®¤ï¼‰
- [ ] Aç”¨æˆ·è·å¾—æ¨èå¥–åŠ±ï¼ˆ10%è¿”ç°é»˜è®¤ï¼‰
- [ ] Adminå¯ä»¥åœ¨é…ç½®é¢æ¿å¯ç”¨/ç¦ç”¨æ¨èç³»ç»Ÿ
- [ ] Adminå¯ä»¥é…ç½®å¥–åŠ±ç™¾åˆ†æ¯”å’Œç±»å‹
- [ ] ç”¨æˆ·dashboardæ˜¾ç¤ºæ¨èç»Ÿè®¡å’Œç¤¾äº¤åˆ†äº«æŒ‰é’®

### æ€§èƒ½éªŒæ”¶
- [ ] æ¨èé“¾æ¥ç”Ÿæˆ < 100ms
- [ ] æ¨èè¿½è¸ªä¸å½±å“é¡µé¢åŠ è½½æ€§èƒ½
- [ ] æ•´ä¸ªåŒ…ç¼–è¯‘å < 50KB

### å®‰å…¨éªŒæ”¶
- [ ] æ¨èç ä½¿ç”¨base64ç¼–ç ï¼Œé˜²æ­¢ç”¨æˆ·IDç›´æ¥æš´éœ²
- [ ] æ¨èå¥–åŠ±è®¡ç®—åœ¨æœåŠ¡ç«¯è¿›è¡Œï¼Œé˜²æ­¢ç¯¡æ”¹
- [ ] Adminé…ç½®éœ€è¦ç®¡ç†å‘˜æƒé™éªŒè¯

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [ ] æ¨èé¢æ¿UIç®€æ´ç¾è§‚ï¼Œç§»åŠ¨ç«¯é€‚é…
- [ ] ç¤¾äº¤åˆ†äº«æŒ‰é’®ä¸€é”®å¤åˆ¶/åˆ†äº«
- [ ] æ¨èç»Ÿè®¡å®æ—¶æ›´æ–°
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­è‹±æ–‡ï¼‰

## ğŸ”— ç›¸å…³èµ„æº

### é¡¹ç›®æ–‡æ¡£
- [CLAUDE.md](../../CLAUDE.md) - å¼€å‘è§„èŒƒ
- [README.md](../../README.md) - é¡¹ç›®æ¶æ„
- [packages/admin/README.md](../../packages/admin/README.md) - AdminåŒ…æ¶æ„

### æŠ€æœ¯å‚è€ƒ
- [Stripe Webhooks](https://stripe.com/docs/webhooks) - æ”¯ä»˜äº‹ä»¶å¤„ç†
- [Next.js Middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware) - æ¨èè¿½è¸ª
- [shadcn/ui Components](https://ui.shadcn.com/) - UIç»„ä»¶åº“

## âš ï¸ æŠ€æœ¯è€ƒè™‘

### æ¶æ„å†³ç­–
- **æ’æ‹”å¼è®¾è®¡**: å®Œå…¨å¯é€‰ï¼Œä¸å½±å“ç°æœ‰ç³»ç»Ÿè¿è¡Œ
- **é›¶ä¾µå…¥é›†æˆ**: ä»…åœ¨æœ‰æ¨èå‚æ•°æ—¶æ‰§è¡Œè¿½è¸ªé€»è¾‘
- **MVPä¼˜å…ˆ**: ä»…å®ç°æ ¸å¿ƒ3ä¸ªå‡½æ•°ï¼Œåç»­å¯æ‰©å±•
- **Adminé…ç½®**: æ”¯æŒè¿è¡Œæ—¶é…ç½®ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²

### é£é™©è¯„ä¼°
- **ä½é£é™©**: MVPåŠŸèƒ½ç®€å•ï¼Œä¾èµ–æœ€å°ï¼Œä¸å½±å“æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- **ä¸­é£é™©**: æ•°æ®åº“Schemaæ‰©å±•éœ€è¦migrationï¼Œéœ€è¦æµ‹è¯•å‘åå…¼å®¹æ€§
- **ç¼“è§£æªæ–½**: æ‰€æœ‰æ–°å¢å­—æ®µè®¾ç½®é»˜è®¤å€¼ï¼Œä¿æŒç°æœ‰æ•°æ®å®Œæ•´æ€§

### æ€§èƒ½è€ƒè™‘
- æ¨èè¿½è¸ªä»…åœ¨æœ‰refå‚æ•°æ—¶æ‰§è¡Œï¼Œå¯¹æ­£å¸¸ç”¨æˆ·æ— å½±å“
- ä½¿ç”¨Redisç¼“å­˜æ¨èç»Ÿè®¡ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- ç¤¾äº¤åˆ†äº«ä½¿ç”¨åŸç”ŸWeb Share APIï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº“

### å…¼å®¹æ€§
- æ”¯æŒç°æœ‰çš„åŒè®¤è¯ç³»ç»Ÿï¼ˆSupabaseä¸»+Firebaseå¤‡ï¼‰
- å…¼å®¹ç°æœ‰çš„å¤šè¯­è¨€ç³»ç»Ÿï¼ˆnext-intlï¼‰
- ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒPWAåˆ†äº«

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- [ ] ReferralMVP.link() å‡½æ•°æµ‹è¯•
- [ ] ReferralMVP.setCookie() å‡½æ•°æµ‹è¯•
- [ ] ReferralMVP.getReward() å‡½æ•°æµ‹è¯•
- [ ] å¥–åŠ±è®¡ç®—é€»è¾‘æµ‹è¯•

### é›†æˆæµ‹è¯•
- [ ] å®Œæ•´æ¨èæµç¨‹æµ‹è¯•ï¼ˆç”Ÿæˆ->åˆ†äº«->ç‚¹å‡»->è´­ä¹°->å¥–åŠ±ï¼‰
- [ ] Stripe Webhookæ¨èå¥–åŠ±å¤„ç†æµ‹è¯•
- [ ] Adminé…ç½®ä¿å­˜å’Œè¯»å–æµ‹è¯•

### ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] ç”¨æˆ·ç”Ÿæˆæ¨èé“¾æ¥å¹¶åˆ†äº«æµç¨‹
- [ ] æ–°ç”¨æˆ·é€šè¿‡æ¨èé“¾æ¥æ³¨å†Œè´­ä¹°æµç¨‹
- [ ] Adminé…ç½®æ¨èè§„åˆ™æµç¨‹

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### ç›‘æ§æŒ‡æ ‡
- æ¨èé“¾æ¥ç‚¹å‡»ç‡
- æ¨èè½¬åŒ–ç‡
- å¥–åŠ±å‘æ”¾æ•°é‡å’Œé‡‘é¢
- ç³»ç»Ÿå¯ç”¨çŠ¶æ€

### æ—¥å¿—è®°å½•
- æ¨èé“¾æ¥ç”Ÿæˆæ—¥å¿—
- æ¨èç‚¹å‡»è¿½è¸ªæ—¥å¿—
- å¥–åŠ±è®¡ç®—å’Œå‘æ”¾æ—¥å¿—
- Adminé…ç½®å˜æ›´æ—¥å¿—

## ğŸš€ éƒ¨ç½²è€ƒè™‘

### éƒ¨ç½²ç­–ç•¥
- åŒ…æ„å»ºï¼šnpm run build
- æ¸è¿›å¼å¯ç”¨ï¼šå…ˆéƒ¨ç½²ä»£ç ï¼Œå†é€šè¿‡Adminé¢æ¿å¯ç”¨
- å›æ»šæ–¹æ¡ˆï¼šAdminé¢æ¿ä¸€é”®ç¦ç”¨åŠŸèƒ½

### ç¯å¢ƒé…ç½®
- æ— éœ€æ–°å¢ç¯å¢ƒå˜é‡
- å¤ç”¨ç°æœ‰æ•°æ®åº“å’Œè®¤è¯ç³»ç»Ÿ
- é€šè¿‡Adminé¢æ¿é…ç½®æ‰€æœ‰å‚æ•°

### æ•°æ®è¿ç§»
- æ‰©å±•ç°æœ‰referralsè¡¨ç»“æ„
- æ·»åŠ é»˜è®¤é…ç½®åˆ°referral_configè¡¨
- ä¿æŒç°æœ‰æ•°æ®å®Œæ•´æ€§

---

## ğŸ“ æ‰§è¡Œè®°å½•

### å¼€å§‹æ—¶é—´
- **å¼€å§‹æ—¥æœŸ**: 2025-01-19
- **æ‰§è¡Œè€…**: Claude Code
- **é¢„è®¡å®Œæˆæ—¶é—´**: 2025-01-19

### è¿›åº¦æ›´æ–°
- **[ç­‰å¾…å¼€å§‹]**: ä»»åŠ¡æ–‡ä»¶å·²åˆ›å»ºï¼Œç­‰å¾…æ‰§è¡Œç¡®è®¤

---

ğŸ’¡ **Claude Code ä½¿ç”¨æç¤º**:
```
# æ‰§è¡Œæ­¤ä»»åŠ¡çš„ Claude Code æŒ‡ä»¤
@tasks/referral/001-referral-mvp-system.md

# æˆ–è€…
"Based on /tasks/referral/001-referral-mvp-system.md, complete the task in one shot."
```
